document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector('meta[name="csrf-token"]'),n=document.querySelector('meta[name="user-id"]'),i=document.querySelector('meta[name="role-id"]'),s=document.querySelector('meta[name="is-super-admin"]');if(!e||!n||!i||!s||parseInt(s.content)===1)return;const o=window.initialPermissions||{};Object.keys(o).length>0&&localStorage.setItem("userPermissions",JSON.stringify(o)),d(),u(e.content,n.content,i.content),a()});function u(e,n,i){const s=new Pusher("9d0fb6df9f1d15dbc9bd",{cluster:"ap2",encrypted:!0,authEndpoint:"/pusher/auth",auth:{headers:{"X-CSRF-Token":e}}}),r=`private-userPermissions.${n}`,o=s.subscribe(r);o.bind("pusher:subscription_error",t=>{console.error("UserMenu error 2:",t)}),o.bind("App\\Events\\UserPermissionUpdated",function(t){t.permissionsList&&(localStorage.setItem("userPermissions",JSON.stringify(t.permissionsList)),d())});const m=`private-rolePermissions.${i}`,l=s.subscribe(m);l.bind("pusher:subscription_error",t=>{console.error("RoleMenu error 1:",t)}),l.bind("App\\Events\\RolePermissionUpdated",function(t){c(t)})}function c(e){const n=JSON.parse(localStorage.getItem("userPermissions"))||{};n[e.permissionHeader]||(n[e.permissionHeader]=[]),e.permissionStatus===0?(n[e.permissionHeader]=n[e.permissionHeader].filter(i=>i!==e.permissionName),n[e.permissionHeader].length===0&&delete n[e.permissionHeader]):e.permissionStatus===1&&(n[e.permissionHeader].includes(e.permissionName)||n[e.permissionHeader].push(e.permissionName)),localStorage.setItem("userPermissions",JSON.stringify(n)),d()}function d(){const e=JSON.parse(localStorage.getItem("userPermissions"))||{},n=(i,s)=>{document.querySelectorAll(i).forEach(r=>{s?r.classList.remove("hidden"):r.classList.add("hidden")})};if(e["Owner Portal"]){const i=["Owner Buildings","Owner Levels","Owner Units"].some(s=>e["Owner Portal"].includes(s));n("#OwnerBuildingss",i),n("#OwnerBuildings",e["Owner Portal"].includes("Owner Buildings")),n("#OwnerLevels",e["Owner Portal"].includes("Owner Levels")),n("#OwnerUnits",e["Owner Portal"].includes("Owner Units")),n("#Owner-Building-Add-Button",e["Owner Portal"].includes("Owner Add Building")),n(".Owner-Building-Edit-Button",e["Owner Portal"].includes("Owner Edit Building")),n("#Owner-Level-Add-Button",e["Owner Portal"].includes("Owner Add Level")),n(".Owner-Level-Edit-Button",e["Owner Portal"].includes("Owner Edit Level")),n("#Owner-Unit-Add-Button",e["Owner Portal"].includes("Owner Add Unit")),n(".Owner-Unit-Edit-Button",e["Owner Portal"].includes("Owner Edit Unit")),n("#OwnerAssignUnits",e["Owner Portal"].includes("Owner Assign Units")),n("#OwnerBuildingsTree",e["Owner Portal"].includes("Owner Buildings Tree")),n("#OwnerRentals",e["Owner Portal"].includes("Owner User Units")),n("#OwnerDepartments",e["Owner Portal"].includes("Owner Departments")),n("#OwnerMemberships",e["Owner Portal"].includes("Owner Memberships")),n("#OwnerStaff",e["Owner Portal"].includes("Owner Staff")),n("#OwnerReports",e["Owner Portal"].includes("Owner Reports")),n("#switch-owner-portal-btn",e["Owner Portal"].length>0)}if(e["Admin Portal"]){const i=["User Management","User Roles","Role Permissions","Dropdowns"].some(r=>e["Admin Portal"].includes(r)),s=["Admin Buildings","Admin Levels","Admin Units"].some(r=>e["Admin Portal"].includes(r));n("#AdminControls",i),n("#AdminUserManagement",e["Admin Portal"].includes("User Management")),n("#AdminUserRoles",e["Admin Portal"].includes("User Roles")),n("#AdminRolePermissions",e["Admin Portal"].includes("Role Permissions")),n("#AdminDropdowns",e["Admin Portal"].includes("Dropdowns")),n("#AdminBuildingss",s),n("#AdminBuildings",e["Admin Portal"].includes("Admin Buildings")),n("#AdminLevels",e["Admin Portal"].includes("Admin Levels")),n("#AdminUnits",e["Admin Portal"].includes("Admin Units")),n("#Admin-Building-Add-Button",e["Admin Portal"].includes("Admin Add Building")),n(".Admin-Building-Edit-Button",e["Admin Portal"].includes("Admin Edit Building")),n("#Admin-Level-Add-Button",e["Admin Portal"].includes("Admin Add Level")),n(".Admin-Level-Edit-Button",e["Admin Portal"].includes("Admin Edit Level")),n("#Admin-Unit-Add-Button",e["Admin Portal"].includes("Admin Add Unit")),n(".Admin-Unit-Edit-Button",e["Admin Portal"].includes("Admin Edit Unit")),n("#AdminOrganizations",e["Admin Portal"].includes("Organizations")),n("#AdminReports",e["Admin Portal"].includes("Admin Reports")),n("#switch-admin-portal-btn",e["Admin Portal"].length>0)}}function a(){window.addEventListener("storage",e=>{e.key==="userPermissions"&&d()})}
